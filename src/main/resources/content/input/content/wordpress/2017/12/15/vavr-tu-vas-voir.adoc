:jbake-type: post
:jbake-status: published
:jbake-title: Vavr, tu vas voir !
:jbake-tags: chtijug,java,_mois_dÃ©c.,_annÃ©e_2017
:jbake-date: 2017-12-15
:jbake-depth: ../../../../
:jbake-uri: wordpress/2017/12/15/vavr-tu-vas-voir.adoc
:jbake-excerpt: 
:jbake-source: https://riduidel.wordpress.com/2017/12/15/vavr-tu-vas-voir/
:jbake-style: wordpress

++++
<p>
<div id="preamble">
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-3">
</p>
<p>
Merci Ã  Norsys, qui offre le food truck ce soir (!). (par contre, le chauffage semble Ãªtre mort dans la soirÃ©e).
</p>
<p>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/Noplopy" class="screenName"><img src="http://pbs.twimg.com/profile_images/420712031827009536/nTzQOD2l_mini.jpeg" alt="profile of je suis nÃ© Ã  l'Ã¢ge de 0 an."/>Noplopy</a>
<br/>
<span class="name">Noham PamuÅ‚a</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/Noplopy/status/941Â 378Â 521Â 078Â 943Â 744" class="date">14 dÃ©c. 2017 Ã  19:45:04</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">@chtijug #VAVR at @norsyseasymaker with @glours https://t.co/ki51BpLemZ</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/DRByvyHXkAAo4sf.jpg" alt="941Â 378Â 487Â 352Â 528Â 896"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="paragraph data-line-5">
</p>
<p>
Guillaume nous vient de chez Saagie (oÃ¹ je connais quelquâ€™un â€¦â€‹ depuis pas mal de temps) dans l'Ã©quipe dâ€™outillage. Et quand il parle, jâ€™ai presque lâ€™impression dâ€™entendre parler un collÃ¨gue tout aussi barbu, mais plus rancheros â€¦â€‹
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-7">
<br/>
<h2 id="truela_programmation_fonctionnelle">La programmation fonctionnelle</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-8">
</p>
<p>
Câ€™est de la programmation sans effet de bords, et câ€™est cool. Et pour faciliter Ã§a, les fonctions sont des Ã©lÃ©ments essentiels du langage, les variables sont immutables (Ã§a nâ€™a pas de rapport avec la programmation fonctionnelle, en vrai, mais Ã§a fait maintenant partie du canon fonctionnel).
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-10">
</p>
<p>
Enfin, ce qui est important pour Guillaume, câ€™est aussi la transparence rÃ©fÃ©rentielle (ou referential transparency) qui garantit que deux appels Ã  la mÃªme fonction retourneront le mÃªme rÃ©sultat.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-12">
</p>
<p>
Par exemple, <code>Math.random()</code> ne respecte pas cet aspect, mais <code>Math.max(1, 2)</code> oui.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-14">
<br/>
<h2 id="truejava_8_est_d_ja_fonctionnel">Java 8 est dÃ©ja fonctionnel ?</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-16">
</p>
<p>
Ben oui, avec les lambda, les streams, les <code>Optional&#60;?&#62;</code>, câ€™est un dÃ©but. Mais pour Guillaume il manque des trucs.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-18">
<br/>
<h2 id="truevavr_anciennement_javaslang">Vavr â€¦â€‹ anciennement Javaslang</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-20">
</p>
<p>
La librairie a Ã©tÃ© crÃ©Ã©e par un dÃ©veloppeur Scala frustrÃ© par Java. Et le nouveau logo retourne joliment Java â€¦â€‹
</p>
<p>
</div>
<br/>
<div class="sect2 data-line-22">
<br/>
<h3 id="trueles_collections_java_c_est_pas_pratique">Les collections Java, câ€™est pas pratique</h3>
<br/>
<div class="paragraph data-line-23">
</p>
<p>
Il y en a en java â€¦â€‹ mais câ€™est loin d'Ãªtre pratique. Parce qu'Ã  la base les collections sont conÃ§ues pour Ãªtre mutables (et pas parce quâ€™ils nâ€™ont pas compris lâ€™immutabilitÃ©). Autrement dit, elles ne sont pas joliment immuables, ce qui fÃ¢che les puristes. Donc vavr redÃ©finit ses collections (y compris un <code>Vector</code>).
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-26">
</p>
<p>
Typiquement, les mÃ©thodes <code>Collection.stream()</code> et <code>Stream.collect()</code> nâ€™existent pas en vavr, parce que les collections sont conÃ§ues autour de concepts fonctionnels.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-28">
</p>
<p>
Guillaume mentionne ensuite un point intÃ©ressant : en programmation fonctionnelle, on nâ€™aime pas trop les exceptions parce quâ€™elles ne respectent pas trop le flux dâ€™opÃ©rations.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-30">
<br/>
<h3 id="truestreams_inconsistents">Streams inconsistents</h3>
<br/>
<div class="paragraph data-line-31">
</p>
<p>
Parfois, les streams Java dÃ©marrent leurs opÃ©rations un peu en avance. Du coup, deux appels successifs Ã  Stream.map`(â€¦â€‹.)` peuvent balancer des exceptions, ce qui est insupportable pour Guillaume â€¦â€‹ Peut-Ãªtre pas autant pour moi.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-33">
<br/>
<h3 id="truestreams_de_map">Streams de Map</h3>
<br/>
<div class="paragraph data-line-34">
</p>
<p>
En Java, utiliser un stream sur une map, câ€™est lâ€™enfer (il faut faire le stream sur l' <code>entrySet()</code> et reconstruire la Map au moment du collect). Par contre, en vavr, câ€™est super facile parce que vavr va mapper les couples clÃ©/valeur vers des <code>Tuple</code>.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-36">
<br/>
<h2 id="truevalue_types">Value types</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-37">
</p>
<p>
Ils arriveront en Java 10, peut-Ãªtre (il faudrait demander Ã  RÃ©mi Forax). En revanche, il y en a un paquet dans vavr, inspirÃ©s de Scala, Ã©videment.
</p>
<p>
</div>
<br/>
<div class="sect2 data-line-39">
<br/>
<h3 id="trueoption">Option</h3>
<br/>
<div class="paragraph data-line-40">
</p>
<p>
Hey, mais l' <code>Option</code> de vavr est sÃ©rialisable ! Câ€™est trÃ¨s cool !
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-42">
<br/>
<h3 id="truetry">Try</h3>
<br/>
<div class="paragraph data-line-43">
</p>
<p>
Qui permet dâ€™encapsuler du code susceptible de lancer une exception. Lâ€™exception sera gentiment catchÃ©e et conservÃ©e. Câ€™est pas bÃªte du tout.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-45">
<br/>
<h3 id="trueeither">Either</h3>
<br/>
<div class="paragraph data-line-46">
</p>
<p>
LÃ , on est en plein dans la scalaterie. Ca permet de retourner deux types diffÃ©rents en disant que le retour est soit lâ€™un soit lâ€™autre. Bon, jusque lÃ , câ€™ets un tuple. La particularitÃ© d' <code>Either</code>, câ€™est quâ€™on prend comme convention que le bon cas est celui de droite â€¦â€‹ autrement dit le deuxiÃ¨me â€¦â€‹ Je trouve Ã§a pÃ©nible et un authentique retour en arriÃ¨re.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-48">
<br/>
<h3 id="truevalidation">Validation</h3>
<br/>
<div class="paragraph data-line-49">
</p>
<p>
Qui ressemble furieusement Ã  Bean Validation dans lâ€™objectif â€¦â€‹ mais pas du tout dans lâ€™implÃ©mentation, puisque câ€™est encore un Tuple, voire mÃªme un Either particulier.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-51">
<br/>
<h2 id="truedes_fonctions">Des fonctions</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-52">
</p>
<p>
vavr ajoute aux <code>Function</code> et <code>BiFunction</code> des interfaces permettant dâ€™utiliser jusqu'Ã  8 paramÃ¨tres. Ca nâ€™est pas trÃ¨s pur fonctionnellement, mais câ€™est bien pratique.
</p>
<p>
</div>
<br/>
<div class="sect2 data-line-54">
<br/>
<h3 id="truecomposition">Composition</h3>
<br/>
<div class="paragraph data-line-55">
</p>
<p>
Mais bien sÃ»r quâ€™on peut composer des fonctions avec vavr !
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-57">
<br/>
<h3 id="truelifting">Lifting</h3>
<br/>
<div class="paragraph data-line-58">
</p>
<p>
Chez les fonctionnalistes, câ€™est la transformation dâ€™une fonction impure en fonction pure. Et je dois bien dire que câ€™est assez propre.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-60">
<br/>
<h3 id="trueapplication_partielle_de_fonctions">Application partielle de fonctions</h3>
<br/>
<div class="paragraph data-line-61">
</p>
<p>
LÃ  aussi, Ã§a fait rÃªver tous les haskelliens, et câ€™est assez simplement rÃ©alisÃ©. Mais mon voisin pose une excellente question : si jâ€™applique ma fonction partielle Ã  5 paramÃ¨tres, lequel reste Ã  utiliser ? Le premier ou le dernier ?
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-63">
<br/>
<h3 id="truecurryfication">Curryfication</h3>
<br/>
<div class="paragraph data-line-64">
</p>
<p>
A priori, câ€™est trÃ¨s semblable Ã  lâ€™application partielle, tout en Ã©tant subtilement diffÃ©rent.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-66">
<br/>
<h3 id="truem_moisation">MÃ©moisation</h3>
<br/>
<div class="paragraph data-line-67">
</p>
<p>
Un peu comme un cache, en fait â€¦â€‹ mais sans avoir besoin de rÃ©Ã©crire Ã  chaque fois.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-69">
<br/>
<h2 id="trueet_maintenant_le_pattern_matching">Et maintenant, le pattern matching</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-70">
</p>
<p>
Alors lÃ  Ã§a va Ãªtre un peu fou â€¦â€‹ Toujours est-il que, vous le savez maintenant, le pattern matching, câ€™est un switch sous stÃ©roÃ¯des (mais alors beaucoup de stÃ©roÃ¯des). Par contre, comme vavr reste du Java, câ€™est la syntaxe habituelle qui est utilisÃ©e. Et du coup, câ€™est moins surprenant puisque lâ€™instruction langage est remplacÃ©e par des appels de mÃ©thode dans tous les sens. Ca nâ€™est pas forcÃ©ment trÃ¨s lisible Ã  mon sens, mais bon. En revanche, ce qui est vraiment moche, câ€™est que le cas dâ€™usage typique, câ€™est pour faire des <code>instanceOf</code> plus propres de la maniÃ¨re suivante :
</p>
<p>
</div>
<br/>
<div class="literalblock data-line-73">
<br/>
<div class="content">
<br/>
<pre>Number plusOne = Match(obj).of(
<br/>
Case($(instanceOf(Integer.class)), i -&#62; i + 1),
<br/>
Case($(instanceOf(Double.class)), d -&#62; d + 1),
<br/>
Case($(), o -&#62; { throw new NumberFormatException(); })
<br/>
);</pre>
<br/>
</div>
<br/>
</div>
<br/>
<div class="paragraph data-line-79">
</p>
<p>
Bon, ben lÃ , franchement, je suis dÃ©solÃ©, mais il nâ€™y a aucune espÃ¨ce de gain par rapport au simple <code>instanceof</code>dans un if (qui est un foutu antipattern).
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-81">
</p>
<p>
Par contre, pour filtrer une liste dâ€™adresses entre valides et invalides, câ€™est pas mal du tout (merci <code>Either</code>).
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-83">
<br/>
<h2 id="trueproperty_checking">Property Checking</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-84">
</p>
<p>
On parle ici de la gÃ©nÃ©ration automatique de cas de tests. Et il y a pour les diffÃ©rents types de variables simples, des gÃ©nÃ©rateurs alÃ©atoires inclus. Ca nâ€™est pas inintÃ©ressant â€¦â€‹ mais le test est salement polluÃ© par tout le code supplÃ©mentaire nÃ©cessaire pour gÃ©rer ce contenu alÃ©atoire. Il me semble quâ€™il y a dâ€™autres outils qui fournissent le mÃªme genre de services
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/glours" class="screenName"><img src="http://pbs.twimg.com/profile_images/851392147563696128/xfVcQjXP_mini.jpg" alt="profile of Sr Software engineer @docker - Member of @DevoxxFr  - @glours@framapiaf.org"/>glours</a>
<br/>
<span class="name">GuillaumeğŸ»</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/glours/status/941Â 401Â 921Â 381Â 982Â 208" class="date">14 dÃ©c. 2017 Ã  21:18:03</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Quel accueil pour l'after @chtijug ğŸ’•
<br/>
Merci @norsyseasymaker pour le food truck et la biÃ¨re ! https://t.co/8f1tpDtmlf</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/DRCIA9KW4AENws0.jpg" alt="941Â 401Â 872Â 119Â 816Â 193"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="sect1 data-line-86">
<br/>
<h2 id="trueconclusion">Conclusion</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-88">
</p>
<p>
La prÃ©sentation Ã©tait intÃ©ressante et Guillaume sacrÃ©ment motivÃ© pour nous convaincre (et Ã§a, câ€™est trÃ¨s cool). NÃ©anmoins, je ne peux pas m'Ã´ter de la tÃªte lâ€™idÃ©e que vavr est avant tout un exercice de style, une espÃ¨ce de figure imposÃ©e Ã©ventuellement utilisable sur un projet, mais dont Ã§a nâ€™est pas le but premier. Pour moi, le but de ce genre de librairie (comme Ã§a a pu l'Ãªtre quand jâ€™ai Ã©crit gaedo), câ€™est avant tout de tester la faisabilitÃ© dâ€™un concept. AprÃ¨s, pour lâ€™utiliser, il faut quand mÃªme avoir des besoins qui sont Ã  mon sens particulier (surtout si quelquâ€™un veut sortir de Java 8 pour utiliser vavr). Lâ€™idÃ©e est nÃ©anmoins intÃ©ressante, et certains aspects mâ€™ont paru particuliÃ¨rement sÃ©duisants.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
</p>
++++