:jbake-type: post
:jbake-status: published
:jbake-title: Asciidoc for the win !
:jbake-tags: asciidoc,documentation,structurizr,_mois_f√©vr.,_ann√©e_2017
:jbake-date: 2017-02-23
:jbake-depth: ../../../../
:jbake-uri: wordpress/2017/02/23/asciidoc-for-the-win.adoc
:jbake-excerpt: 
:jbake-source: https://riduidel.wordpress.com/2017/02/23/asciidoc-for-the-win/
:jbake-style: wordpress

++++
<p>
Il y a quelques temps, j'avais √©crit un article expliquant <a href="https://riduidel.wordpress.com/2017/01/13/ne-livrez-pas-de-document-office/">pourquoi les documents Office n'√©taient pas de bons livrables</a>. J'y indiquais par ailleurs qu'Asciidoc me semblait une bonne alternative.
</p>
<p>
Mais un format, √ßa n'est qu'un format. Une documentation, √ßa n'est h√©las pas qu'un format technique de document. C'est aussi, avant tout, le moyen de raconter l'histoire du logiciel. Et parfois, √ßa n'est pas facile
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/simonbrown" class="screenName"><img src="http://pbs.twimg.com/profile_images/1326809575782313987/EWeNACF1_mini.jpg" alt="profile of Author "Software Architecture for Developers" | C4 model & @structurizr for software architecture diagramming | Keynote speaker & trainer | üåé‚úàÔ∏èüë®‚Äçüíª‚òïÔ∏èüèÑüèª‚Äç‚ôÇÔ∏è"/>simonbrown</a>
<br/>
<span class="name">Simon Brown</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/simonbrown/status/831¬†760¬†029¬†879¬†517¬†186" class="date">15 f√©vr. 2017 √† 08:00:19</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">I'm still surprised by the number of teams who have no documentation for mission-critical software systems.</span>
</p>
<p>
<span class="medias">
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<h2>A la recherche du bon format</h2>
<br/>
Pas son histoire au sens biographique, mais plus son usage, son architecture, bref, l'ensemble des √©l√©ments qui contraignent son code √† avoir sa structure. Autrement dit, les √©l√©ments qui donnent les r√©ponses aux questions invraissemblables que se posent un d√©veloppeur.
</p>
<p>
[caption id="attachment_4184" align="alignnone" width="744"]<img class="alignnone size-full wp-image-4184" src="https://riduidel.files.wordpress.com/2017/02/you_down_wit_opc-yeah_you_know_me.png" alt="you_down_wit_opc-yeah_you_know_me" width="744" height="612" /> C'est pas que je d√©teste, c'est que je comprend pas l'histoire[/caption]
</p>
<p>
Et √ßa, que j'√©crive ma doc dans Word, en Asciidoc, en LaTeX, la question se pose toujours : pourquoi ces d√©cisions ont √©t√© prises.
</p>
<p>
Heureusement, j'ai d√©couvert il y a quelques temps le format de documentation agile de Simon Brown, qu'il documente dans <a href="https://www.structurizr.com/help/documentation">la doc de Structurizr</a>.
</p>
<p>
Regardons ensemble le sommaire :
<br/>
<ol>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/context">Context</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/functional-overview">Functional Overview</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/quality-attributes">Quality Attributes</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/constraints">Constraints</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/principles">Principles</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/software-architecture">Software Architecture</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/code">Code</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/data">Data</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/infrastructure-architecture">Infrastructure Architecture</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/deployment">Deployment</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/development-environment">Development Environment</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/operation-and-support">Operation and Support</a></li>
<br/>
<li><a href="https://www.structurizr.com/help/documentation/decision-log">Decision Log</a></li>
<br/>
</ol>
<br/>
Et maintenant, imaginez ce que √ßa donne pour votre projet. Tous les aspects sont document√©s dans un seul gros document Word. C'est p√©nible ... heureusement, l√†, asciidoc peut vous aider.
</p>
<p>
Je vous montre : si votre doc est en asciidoc, vous pouvez faire des <a href="http://asciidoctor.org/docs/user-manual/#include-directive">include</a>.
</p>
<p>
Et donc, vous pouvez avoir un dossier de doc qui ressemble un peu √† √ßa
<br/>
<ul>
<br/>
<li><code><code>monprojet.adoc</code></code></li>
<br/>
<li><code>images/</code> Vous mettez toutes vos images l√†-dedans</li>
<br/>
<li><code>includes</code> Et chacun des chapitres de votre doc est un document s√©par√© dans ce dossier.
<br/>
<ul>
<br/>
<li><code>/00_intro.adoc</code></li>
<br/>
<li><code>/01_context.adoc</code></li>
<br/>
<li><code>/02_functional_overview.adoc</code></li>
<br/>
<li><code>/03_quality_attributes.adoc</code></li>
<br/>
<li><code>/04_constraints.adoc</code></li>
<br/>
<li><code>/05_principles.adoc</code></li>
<br/>
<li><code>/06_software_architecture.adoc</code></li>
<br/>
<li><code>/07_code</code> Si vous avez des √©l√©ments √† d√©tailler, n'h√©sitez pas √† cr√©er des sous-dossiers
<br/>
<ul>
<br/>
<li><code>/un_detail.adoc</code></li>
<br/>
</ul>
<br/>
</li>
<br/>
<li><code>/07_code.adoc</code></li>
<br/>
<li><code>/08_data.adoc</code></li>
<br/>
<li><code>/09_infrastructure_architecture.adoc</code></li>
<br/>
<li><code>/10_deployment.adoc</code></li>
<br/>
<li><code>/11_development_environment.adoc</code></li>
<br/>
<li><code>/12_operation_and_support.adoc</code></li>
<br/>
<li><code>/13_usage.adoc</code></li>
<br/>
<li><code>/14_decision_log.adoc</code></li>
<br/>
<li><code>/99_faq.adoc</code></li>
<br/>
</ul>
<br/>
</li>
<br/>
</ul>
<br/>
Du coup, avec tout √ßa, vous avez une documentation correctement d√©coup√©e, dans laquelle vous mettez vos diagrammes UML (ou autres) g√©n√©r√©s avec asciidoctor-diagram, et vous √™tes content ...
</p>
<p>
Bon, et puis si vous n'√™tes pas contents de ce format, Simon Brown mentionne √©galement le support d'arc42, qui a l'air tout aussi int√©ressant :
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/simonbrown" class="screenName"><img src="http://pbs.twimg.com/profile_images/1326809575782313987/EWeNACF1_mini.jpg" alt="profile of Author "Software Architecture for Developers" | C4 model & @structurizr for software architecture diagramming | Keynote speaker & trainer | üåé‚úàÔ∏èüë®‚Äçüíª‚òïÔ∏èüèÑüèª‚Äç‚ôÇÔ∏è"/>simonbrown</a>
<br/>
<span class="name">Simon Brown</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/simonbrown/status/832¬†599¬†822¬†972¬†620¬†800" class="date">17 f√©vr. 2017 √† 15:37:21</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Structurizr now supports the @arc42Tipps documentation template; example -> https://t.co/lEwIj9Mrxh & code -> https://t.co/gn71mtGfQP #arc42 https://t.co/ONHUYxPaqX</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/C439H71WAAM7zGx.png" alt="832¬†599¬†818¬†895¬†753¬†219"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
</p>
<p>
A un d√©tail pr√®s.
</p>
<p>
Parfois, il y a du code que vous voulez voir g√©n√©r√© pour le mettre dans la doc.
</p>
<p>
Par exemple, si vous utilisez le <a href="https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html">ServiceLoader </a>de Java, savoir quelles classes impl√©mentent une interface sans avoir √† chercher dans Eclipse, c'est cool.
<br/>
<h2>Tant qu'√† g√©n√©rer la doc, pourquoi ne pas g√©n√©rer la doc ?</h2>
<br/>
Parce qu'en fait, votre doc asciidoc, vous la g√©n√©rez, pas vrai ? Si vous faites du maven, vous utilisez sans doute le maven-asciidoc-plugin. Je vais faire l'hypoth√®se que vous √™tes dans ce cas.
</p>
<p>
Et dans ce cas, si vous avez besoin d'avoir un morceau de la doc qui d√©pende plus directement du code, vous pouvez tout √† fait ... utiliser Groovy pour g√©n√©rer des fichiers asciidoc qui vont bien !
</p>
<p>
Typiquement, pour mon exemple, j'ai un script Groovy qui a dans son CLASSPATH tous les modules de mon application, et qui √† l'aide de <a href="https://github.com/ronmamo/reflections">reflections </a>recherche les impl√©mentations de l'interface pour g√©n√©rer un tableau Asciidoc les affichant.
</p>
<p>
Et comme ce script Groovy est lanc√© gr√¢ce √† <a href="https://groovy.github.io/gmaven/">gmaven </a>avant la g√©n√©ration de la doc, cette partie est toujours √† jour.
<br/>
<h2>Et pour un projet multimodule ?</h2>
<br/>
Pour l'instant, j'ai juste test√© √ßa une fois, et d'une fa√ßon non satisfaisante. Comme j'arrivais sur un projet existant, j'ai simplement ajout√© un module doc isol√© du reste de l'application.
</p>
<p>
Je pense que j'aurais eu une doc d'une bien meilleure qualit√© si j'avais mis la doc dans chaque module avec des includes bien costauds dans la doc du module global (voire m√™me des morceaux compl√®tement g√©n√©r√©s). Evidement, dans ce genre de cas, la g√©n√©ration de la documentation doit √©galement √™tre document√©e ...
<br/>
<h2>Donc √ßa marche bien ?</h2>
<br/>
Oh que oui !
</p>
<p>
Ecrire de la doc est presque agr√©able, et les aspects g√©n√©rationnels sont une distraction encore plus agr√©able. Sans m√™me parler de la fusion de cette doc et des diff√©rents diagrammes qui y sont int√©gr√©s.
</p>
<p>
Mais je crois qu'on peut aller encore beaucoup plus loin. Pas directement avec cette technique, mais sans doute en amont, via des graphes.
<br/>
<h2>On pourrait faire encore mieux ?</h2>
<br/>
Je vous donne quelques exemples.
</p>
<p>
Pour d√©crire votre applications, vous utilisez en fait plusieurs graphes
<br/>
<ul>
<br/>
<li>L'architecture conceptuelle (ou fonctionnelle) d√©crit comment les composants remplissent les fonctions</li>
<br/>
<li>L'architecture applicative organise ces composants en modules</li>
<br/>
<li>L'architecture technique montre comment ces composants se d√©ploient.</li>
<br/>
</ul>
<br/>
Tout √ßa est cens√© √™tre √† peu pr√®s couvert par Structurizr.
</p>
<p>
Mais d'autres √©l√©ments ne le sont pas : quand je d√©cris une organisation de classe, c'est aussi un graphe. Et un diagramme de s√©quence pourrait tout √† fait √™tre construit √† partir du code un peu annot√©.
</p>
<p>
Imaginez que je dispose d'un mod√®le comme celui de Structurizr, mais enrichi √† la fois avec les informations du code (pour produire les diff√©rents diagrammes de bas niveau), et pour lequel je puisse g√©n√©rer des diagrammes via une quelconque syntaxe de recherche des noeuds dans un graphe. Je pourrais alors demander facilement des trucs comme
<br/>
<blockquote>Dessine-moi le diagramme de s√©quence partant de cette interaction Javascript et incluant les √©changes avec le serveur, la base de donn√©es, et le composant Java bidule</blockquote>
<br/>
Et d'un coup, je n'ai plus un simple outil de documentation, mais un outil d'analyse et de compr√©hension de mon code, que je peux ensuite faire produire un truc que j'ai bien gal√©r√© √† faire il y a quelques temps :
<br/>
<blockquote>Fais-moi un diagramme de composant o√π les classes sont colori√©s en fonction de leur dette technique</blockquote>
<br/>
Bon, c'est une tr√®s chouette id√©e, et je sais √† peu pr√®s comment l'impl√©menter ... Mais c'est malheureusement encore un projet de plus. Et mon temps est d√©j√† bien rempli.
</p>
++++