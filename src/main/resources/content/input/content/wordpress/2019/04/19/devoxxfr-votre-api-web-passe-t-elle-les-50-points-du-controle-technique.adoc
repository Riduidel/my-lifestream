:jbake-type: post
:jbake-status: published
:jbake-title: Devoxxfr - Votre API web passe-t-elle les 50 points du contrÃ´le technique ?
:jbake-tags: api,architecture,communication,_mois_avr.,_annÃ©e_2019
:jbake-date: 2019-04-19
:jbake-depth: ../../../../
:jbake-uri: wordpress/2019/04/19/devoxxfr-votre-api-web-passe-t-elle-les-50-points-du-controle-technique.adoc
:jbake-excerpt: 
:jbake-source: https://riduidel.wordpress.com/2019/04/19/devoxxfr-votre-api-web-passe-t-elle-les-50-points-du-controle-technique/
:jbake-style: wordpress

++++
<p>
<div id="preamble">
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-3">
</p>
<p>
Donc les api, câ€™est quoi ?
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-5">
</p>
<p>
Dans les annÃ©es 60, une API, c'Ã©tait une interface vers une bibliothÃ¨que dans une machine. Dans les annÃ©es 90, on voit apparaÃ®tre le MOM, les queues. EN 2000 le concept de REST apparaÃ®t. En 2010, les API publiques Ã©mergent, et deviennent des plateformes exploitables Ã  lâ€™extÃ©rieur.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-10">
</p>
<p>
AprÃ¨s cette introduction, est-ce que notre API passe le contrÃ´le technique ?
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-12">
</p>
<p>
Des points de contrÃ´le pour API, Ã§a existe â€¦â€‹ Et dans une liste complÃ¨te, il y en aurait plus de 70. Et ce serait bien dâ€™utiliser ces points de contrÃ´le dÃ¨s le dÃ©but dâ€™un projet.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/LairFR" class="screenName"><img src="http://pbs.twimg.com/profile_images/1293487489005563905/pc7MnFn3_mini.jpg" alt="profile of Technical leadership, systems, webdev, crypto"/>LairFR</a>
<br/>
<span class="name">Lair</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/LairFR/status/1Â 119Â 202Â 965Â 783Â 445Â 504" class="date">19 avr. 2019 Ã  13:35:55</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">You NEED a checklist, why do you even think you can just wing it and think about a few things ? https://t.co/erbrvQdzvG</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/D4g1KIQX4AA0C7z.jpg" alt="1Â 119Â 202Â 955Â 532Â 689Â 408"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="sect1 data-line-15">
<br/>
<h2 id="trueavant_le_d_veloppement">Avant le dÃ©veloppement</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-16">
</p>
<p>
Il faut dâ€™abord dÃ©finir les objectifs de notre API. Ce sont les SLO (service level objectives). Ces objectifs incluent Ã©videment des besoins mÃ©tier. Ces besoins sont Ã©videment mesurables, pour construire des dashboards, de lâ€™alerting, des indicateurs.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-20">
</p>
<p>
Ã‰videment, ces SLO viennent avec des SLA (service level agreement) qui contractualisent ces objectifs. Autrement dit, que se passe-t-il quand les objectifs ne sont pas atteints ?
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-22">
</p>
<p>
Ensuite, câ€™est le bon moment de nommer le service. Ce nommage doit Ãªtre ennuyeux. Parce quâ€™il doit Ãªtre transparent, descriptif, non ambigu. Lâ€™intÃ©rÃªt, câ€™est que si cette rÃ¨gle est appliquÃ©e globalement, si deux services veulent porter le mÃªme nom, câ€™est sans doute quâ€™il sâ€™agit du mÃªme service.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-26">
<br/>
<h2 id="truependant_le_d_veloppement">Pendant le dÃ©veloppement</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-28">
</p>
<p>
Il faut penser Ã  la connexion entre le service et un IAM (pour la gestion de la sÃ©curitÃ©). Cette connexion va impliquer que les appels au service passent dâ€™abord par lâ€™IAM. Ca veut dire que toutes les API doivent Ãªtre authentifiÃ©es pour communiquer. Câ€™est clairement la fin de la sÃ©curitÃ© pÃ©rimÃ©trique
</p>
<p>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/LairFR" class="screenName"><img src="http://pbs.twimg.com/profile_images/1293487489005563905/pc7MnFn3_mini.jpg" alt="profile of Technical leadership, systems, webdev, crypto"/>LairFR</a>
<br/>
<span class="name">Lair</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/LairFR/status/1Â 119Â 205Â 533Â 721Â 026Â 560" class="date">19 avr. 2019 Ã  13:46:07</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Be paranoid, apply zero trust to everything, the days of the "DMZ" are gone. Assume you will be hacked https://t.co/ZgCjYz4WFo</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/D4g3fwJWwAEGYFv.jpg" alt="1Â 119Â 205Â 526Â 041Â 182Â 209"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="paragraph data-line-31">
</p>
<p>
Ensuite, il faut rÃ©flÃ©chir au versionning de lâ€™API et le changelog. Mais comment le client pourra-t-il accÃ©der Ã  une version de lâ€™API ? En HTTP, on peut utiliser le header <code>Accept</code>. On peut aussi utiliser des sous-domaines par version (ou des chemins). Il peut aussi parfois arriver que les utilisateurs aient accÃ¨s Ã  des versions diffÃ©rentes par utilisateur. A noter que chez Stripe, ils font aussi de la transcription dâ€™une version Ã  une autre (comme le fait XXX pour les bases de donnÃ©es).
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-38">
</p>
<p>
Il faut Ã©galement rÃ©flÃ©chir Ã  la gestion de la compatibilitÃ© : que veut dire la compatibilitÃ© ascendante/descendante. Et Ã©videment, il faut sâ€™en assurer â€¦â€‹ et donc tester les diffÃ©rentes versions de lâ€™API. Twitter a dÃ©veloppÃ© un outil (<a href="https://github.com/twitter/diffy">diffy</a>) pour comparer les versions dâ€™une API et accÃ©lÃ©rer la dÃ©tection de bugs de migration de version.
</p>
<p>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/LairFR" class="screenName"><img src="http://pbs.twimg.com/profile_images/1293487489005563905/pc7MnFn3_mini.jpg" alt="profile of Technical leadership, systems, webdev, crypto"/>LairFR</a>
<br/>
<span class="name">Lair</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/LairFR/status/1Â 119Â 207Â 276Â 844Â 285Â 952" class="date">19 avr. 2019 Ã  13:53:03</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Useful tool to test the difference between API versions https://t.co/yFQ17KmNHy https://t.co/KSQPeNDagZ</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/D4g5FA0XoAEHL2N.jpg" alt="1Â 119Â 207Â 265Â 683Â 349Â 505"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="paragraph data-line-42">
</p>
<p>
Il faut aussi penser aux Ã©lÃ©ments classiques : la pagination, la recherche, le tri, le filtrage, la sÃ©lection ou lâ€™extension des champs. Prenons lâ€™exemple de la pagination. Si elle nâ€™est pas gÃ©rÃ©e au dÃ©but, Ã§a peut vite poser des problÃ¨mes de taille de rÃ©sultats.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-46">
</p>
<p>
En terme de sÃ©curitÃ©, il vaut aussi penser Ã  supprimer les empreintes des outils utilisÃ©s, afin de rÃ©duire la surface dâ€™attaque de lâ€™API face aux agresseurs informatiques.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-48">
</p>
<p>
En informatique, on sÃ©pare l'Ã©tat et la logique. Dans notre API, on peut Ã©muler Ã§a en stockant les donnÃ©es de faÃ§on immutable. On gagne beaucoup de choses facilement de cette faÃ§on (historique, rollback, â€¦â€‹)
</p>
<p>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/LairFR" class="screenName"><img src="http://pbs.twimg.com/profile_images/1293487489005563905/pc7MnFn3_mini.jpg" alt="profile of Technical leadership, systems, webdev, crypto"/>LairFR</a>
<br/>
<span class="name">Lair</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/LairFR/status/1Â 119Â 208Â 689Â 209Â 085Â 952" class="date">19 avr. 2019 Ã  13:58:40</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">S3 etc. Offers file/object versioning out of the box so yes you don't need to do event sourcing to have some automatic data versioning https://t.co/NsS22MH0Jj</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/D4g6W_ZXoAEscUA.jpg" alt="1Â 119Â 208Â 674Â 050Â 940Â 929"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="paragraph data-line-51">
</p>
<p>
Quand on utilise un autre service, il faut toujours utiliser la version prod de ce service (mÃªme pour nos environnements de dÃ©veloppement). Ca implique que ces services exposent diffÃ©rents "tenants", au moins pour sÃ©parer les environnements de dÃ©v. Lâ€™impact Ã©vident, câ€™est que les Ã©quipes ne dÃ©pendent que de la prod, et ont donc moins dâ€™indisponibilitÃ©.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-54">
</p>
<p>
Pour les usages publics, la signature HMAC peut Ãªtre utile pour que les consommateurs accÃ¨dent Ã  lâ€™API sans pour autant nÃ©cessiter de compte IAM.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-56">
</p>
<p>
Toujours dans lâ€™objectif de limiter dans lâ€™espace et le temps, il faut dÃ©finir des timeouts, des politiques de rÃ©essai, et des circuit breakers.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-58">
</p>
<p>
Et bien sÃ»r, il faut tester !
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-60">
<br/>
<h2 id="trueavant_la_production">Avant la production</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-62">
</p>
<p>
Il faut dÃ©finir les quotas (nombre de requÃªtes maximum ou requÃªtes/minutes). Chez les GAFAM, il y a des quotas, des limites pour <strong>tout</strong>.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-64">
</p>
<p>
Pensez aussi Ã  crÃ©er des metrics et de lâ€™alerting associÃ© ! Autrement dit, pour chaque mÃ©trique quâ€™on dÃ©finit, il faut dÃ©finir une alerte.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-66">
</p>
<p>
Câ€™est aussi le moment de penser Ã  la documentation publique, soit avec OpenAPI, soit avec des outils de test comme Dredd.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-68">
</p>
<p>
Et de dÃ©finir la politique de mise Ã  jour : blue/green ? rolling upgrades ? dark-launch+canary (voir istio ou Weave Flagger)
</p>
<p>
</div>
<br/>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/LairFR" class="screenName"><img src="http://pbs.twimg.com/profile_images/1293487489005563905/pc7MnFn3_mini.jpg" alt="profile of Technical leadership, systems, webdev, crypto"/>LairFR</a>
<br/>
<span class="name">Lair</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/LairFR/status/1Â 119Â 212Â 896Â 100Â 208Â 640" class="date">19 avr. 2019 Ã  14:15:23</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Levels of deployment expertise, reminds me of levels of REST from @martinfowler https://t.co/QiB47rAdFB</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/D4g-LxUXoAAFFr3.jpg" alt="1Â 119Â 212Â 879Â 339Â 823Â 104"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<h2>Conclusion</h2>
<br/>
La prÃ©sentation Ã©tait trÃ¨s intÃ©ressante ... et trÃ¨s dense ! Clairement, faire tenir ces 50 points de contrÃ´le en 45 minutes Ã©tait un dÃ©fi ambitieux, mais <a href="https://twitter.com/@fgribreau">FranÃ§ois-Guillaume</a> s'en est brillamment sorti !
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/FGRibreau" class="screenName"><img src="http://pbs.twimg.com/profile_images/1007722919701680128/4RUK-PTT_mini.jpg" alt="profile of âš¡ï¸ CTO & Architect as a Service
<br/>
ğŸ“˜ Author: @getnobullshit Tech-Lead
<br/>
ğŸ”¥ #FullStack Indiehacker @imagecharts @cloud_iam_com
<br/>
ğŸ¤ Sold: @redsmin '20 @bringr '17"/>FGRibreau</a>
<br/>
<span class="name">Francois-Guillaume Ribreau</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/FGRibreau/status/1Â 119Â 248Â 478Â 193Â 029Â 120" class="date">19 avr. 2019 Ã  16:36:46</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Lâ€™intÃ©gralitÃ© de la checklist sera disponible sur https://t.co/BHY8HhkpZ2 il suffit dâ€™entrer son email pour la recevoir.</span>
</p>
<p>
<span class="medias">
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
</p>
<p>
</div>
<br/>
</div>
</p>
++++