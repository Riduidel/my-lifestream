:jbake-type: post
:jbake-status: published
:jbake-title: To be or not to be serverless
:jbake-tags: chtijug,cloud,serverless,_mois_mai,_annÃ©e_2019
:jbake-date: 2019-05-24
:jbake-depth: ../../../../
:jbake-uri: wordpress/2019/05/24/to-be-or-not-to-be-serverless.adoc
:jbake-excerpt: 
:jbake-source: https://riduidel.wordpress.com/2019/05/24/to-be-or-not-to-be-serverless/
:jbake-style: wordpress

++++
<p>
<div id="preamble">
<br/>
<div class="sectionbody">
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/chtijug" class="screenName"><img src="http://pbs.twimg.com/profile_images/1179656487326617600/2uFfDuut_mini.jpg" alt="profile of Le Java User Group des Ch'tis d'un Ch'nord"/>chtijug</a>
<br/>
<span class="name">Ch'ti JUG</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/chtijug/status/1Â 131Â 617Â 057Â 823Â 436Â 806" class="date">23 mai 2019 Ã  19:45:05</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Hello Serverless World ğŸ‘‹ https://t.co/7HLU90d5T0</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/D7RPtVSX4AA-Mm7.jpg" alt="1Â 131Â 617Â 046Â 603Â 751Â 424"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
<br/>
<div class="paragraph data-line-3">
</p>
<p>
<a href="https://twitter.com/SteveHouel">Steve</a> va nous faire un tour dâ€™horizon du serverless, dans le cadre de son tour de France (qui continuera Ã  Lille le mois prochain).
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-5">
<br/>
<h2 id="truepr_sentation">PrÃ©sentation</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="sect2 data-line-7">
<br/>
<h3 id="trueun_peu_d_histoire">Un peu dâ€™histoire</h3>
<br/>
<div class="paragraph data-line-8">
</p>
<p>
EN 2006, on a commencÃ© Ã  remplacer la virtualisation par le cloud chez AWS (pour lequel Steve a un gros faible). Puis les conteneurs sont apparus et ont conquis le marchÃ©, puisqu'aujourdâ€™hui, tout le monde connaÃ®t K8s. Puis le serverless est apparu aux environs de 2014.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-12">
<br/>
<h3 id="truec_est_quoi">Câ€™est quoi ?</h3>
<br/>
<div class="paragraph data-line-13">
</p>
<p>
En serverless, on ne gÃ¨re pas les serveurs (Ã§a ne veut pas dire quâ€™ils nâ€™existent pas). En fait, on ne voit pas les serveurs (pas plus quâ€™on ne les gÃ¨re). Si on veut distinguer, il y a
</p>
<p>
</div>
<br/>
<div class="ulist data-line-16">
<br/>
<ul>
<br/>
<li>BaaS : <strong>backend as a service</strong>. Câ€™est le terme utilisÃ© pour les bases de donnÃ©es accÃ©dÃ©s comme un service (<a href="https://www.mongodb.com/cloud/atlas">Mongo Atlas</a>, <a href="https://aiven.io/">Aiven</a>) ou des facilitÃ©s comme <a href="https://auth0.com/">Auth0</a>.</li>
<br/>
<li>FaaS : <strong>function as a service</strong>. Câ€™est la partie Ã  laquelle on va plutÃ´t sâ€™intÃ©resser. On y dÃ©ploie des fonctions, pour lesquelles on ne gÃ¨re pas le CPU/la RAM/lâ€™OS. Et Ã©videment, on paye Ã  la requÃªte.</li>
<br/>
</ul>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-19">
<br/>
<h3 id="truequ_est_ce_qui_n_est_pas_serverless">Quâ€™est-ce qui nâ€™est pas serverless</h3>
<br/>
<div class="ulist data-line-21">
<br/>
<ul>
<br/>
<li>Evidement, le PaaS nâ€™est pas serverless. Par exemple, Heroku nâ€™est pas serverless. Parce que la granularitÃ© nâ€™est pas la mÃªme â€¦â€‹ et le schÃ©ma de pricing nâ€™est Ã©videment pas le mÃªme.</li>
<br/>
<li>Les conteneurs ne sont pas du serverless. Parce quâ€™il va falloir gÃ©rer un orchestrateur.</li>
<br/>
<li>NoOps nâ€™est pas non plus du serverless. Effectivement, il nâ€™y a plus dâ€™OS Ã  gÃ©rer. Mais il faudra toujours garantir la sÃ©curitÃ©. Il faudra Ã©galement observer le systÃ¨me (ce qui devient beaucoup plus compliquÃ© quand les composants se multiplient).</li>
<br/>
</ul>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-25">
<br/>
<h3 id="truequi_fait_du_serverless">Qui fait du serverless</h3>
<br/>
<div class="paragraph data-line-27">
</p>
<p>
AWS Ã©videment. Azure atteint presque le niveau. Il y a Ã©galement des outils basÃ©s sur K8s (OpenFaas). OVH fournit aussi des OVH cloud functions. KNative, OpenWhisk, â€¦â€‹ sont aussi des fournisseurs, moins importants.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-32">
<br/>
<h3 id="trueca_veut_dire_quoi">Ca veut dire quoi ?</h3>
<br/>
<div class="paragraph data-line-34">
</p>
<p>
Dans le mode classique, quand une application prend plus de CPU, on rajoute des machines en fonction des besoins. Mais sur chaque machine, on a surprovisionnÃ© pour se garder de la marge. Et bien sÃ»r, Ã§a coÃ»te de lâ€™argent.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-37">
</p>
<p>
Du coup, on passe Ã  la conteneurisation. Donc on ajoute des pods dans notre cluster. Mais il y a toujours un moment oÃ¹ on va devoir ajouter un nouveau worker K8s, ce qui est Ã  nouveau de la surprovision â€¦â€‹ Mais grosse (parce que le worker K8s est souvent plus costaud).
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-42">
</p>
<p>
En serverless, chaque fonction (câ€™est-Ã -dire chaque Ã©lÃ©ment de lâ€™application) sera scalÃ© indÃ©pendamment, isolÃ©, et dÃ©marrÃ© en fonction des demandes. Cette fonction sera aussi arrÃªtÃ©e dÃ¨s quâ€™elle nâ€™est plus utilisÃ©e. Lâ€™intÃ©rÃªt Ã©vident, câ€™est de sâ€™adapter efficacement aux patterns dâ€™utilisation de lâ€™application.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-46">
<br/>
<h3 id="truede_plus_haut">De plus haut</h3>
<br/>
<div class="paragraph data-line-48">
</p>
<p>
Dans une architecture serverless, il y aura un service externe qui Ã©met des Ã©vÃ©nements. La fonction rÃ©agit Ã  cet Ã©vÃ©nement en Ã©mettant dâ€™autres Ã©vÃ©nements, ou aussi en stockant des donnÃ©es
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-51">
</p>
<p>
Un cas dâ€™utilisation typique est celui de lâ€™application web fortement utilisÃ©e de faÃ§on temporaire (comme par exemple les applis de vote de tÃ©lÃ©rÃ©alitÃ©) : les requÃªtes seront envoyÃ©es sur des fonctions qui vont Ã©crire dans Dynamo pour produire un dashboard accessible worldwide. Un autre cas courant est celui du traitement de fichier en masse : on envoie les fichiers dans S3, ces insertions crÃ©ent des Ã©vÃ©nements qui sont traitÃ©s par des fonctions pour Ã©crire dans S3 ou Dynamo. Lâ€™IoT est aussi un trÃ¨s bon cas dâ€™usage, en particulier parce que la consommation de ressources va Ã©voluer rapidement dans le temps.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-55">
<br/>
<h3 id="trueb_n_fices">BÃ©nÃ©fices</h3>
<br/>
<div class="paragraph data-line-57">
</p>
<p>
Dâ€™abord on rÃ©duit les coÃ»ts opÃ©rationnels. Pas parce quâ€™on a supprimÃ© les ops, mais parce quâ€™on a limitÃ© la charge dâ€™opÃ©ration (en enlevant la gestion des machines). On rÃ©duit aussi le coÃ»t dâ€™utilisation des BaaS (justement parce que ce sont les fournisseurs de ces backends qui en assurent le fonctionnement). Par ailleurs, la scalabilitÃ© devient beaucoup moins coÃ»teuse : pas la peine de penser au dÃ©ploiement de nouvelles machines, ni Ã  la gestion de la parallÃ©lisation du code. Lâ€™optimisation du code permet rÃ©ellement des Ã©conomies, puisque chaque exÃ©cution du code a un coÃ»t identifiable. Enfin, lâ€™exÃ©cution du code sera plus Ã©cologique (parce quâ€™on consomme Ã©videment moins de ressources).
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-64">
<br/>
<h3 id="truecontraintes">Contraintes</h3>
<br/>
<div class="paragraph data-line-66">
</p>
<p>
Avant tout, il ya un vendor-lock-in certain : implÃ©menter du serverless nÃ©cessite de sâ€™adapter au fournisseur. Evidement, le mÃ©tier ne va pas changer. En revanche, toute la partie data/communication sera dÃ©pendante du fournisseur.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-69">
</p>
<p>
Par ailleurs, en termes de sÃ©curitÃ©, Ã§a nâ€™est pas forcÃ©ment facile. Dâ€™abord parce quâ€™on sort de la classique DMZ. Ensuite parce chaque fournisseur a sa proprÃ© implÃ©mentation de politique de sÃ©curitÃ©, ce qui nÃ©cessite nettement une adaptation.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-72">
</p>
<p>
On ne peut bien sÃ»r plus optimiser sa distribution Linux. En mÃªme temps, Ã§a ne sert que dans moins de 1% des cas.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-74">
</p>
<p>
Enfin, les vraies limites sont celles de lâ€™exÃ©cution : le provider va limiter la durÃ©e dâ€™exÃ©cution, le dÃ©lai de dÃ©marrage (et Ã§a, typiquement, Ã  part Quarkus/Micronaut, Ã§a rend le Java inutilisable), la possibilitÃ© de faire des tests dâ€™intÃ©gration, et mÃªme le mode de dÃ©ploiement/packaging/versioning.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-76">
<br/>
<h2 id="trued_mo">DÃ©mo</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="sect2 data-line-78">
<br/>
<h3 id="trueserverless">serverless</h3>
<br/>
<div class="paragraph data-line-79">
</p>
<p>
Steve va faire la dÃ©monstration avec <a href="http://serverless.com/">serverless.com</a> (ils ont choisi le bon nom au bon moment). Normalement, lâ€™outil est raisonnablement agnostique (dans sa version payante au moins).
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-82">
</p>
<p>
Logan me fait immÃ©diatement la remarque que lâ€™agnosticitÃ© du truc est un peu limitÃ© : pour crÃ©er son appli Python, Steve lance la commande <code>sls create -t aws-python3</code>. Et effectivement, le seul intÃ©rÃªt est que la commande est la mÃªme pour aws/azure/â€¦â€‹
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-85">
</p>
<p>
Ca crÃ©e donc un squelette Python, avec un <code>serverless.yml</code> (et oui, câ€™est de lâ€™infra as code, donc câ€™est du YAML) qui dÃ©crit comment elle sera appelÃ©e.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-87">
</p>
<p>
Et un appel Ã  <code>sls deploy</code> va dÃ©ployer les Ã©lÃ©ments nÃ©cessaires pour rendre la fonction utilisable depuis AWS.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-89">
</p>
<p>
Et Ã§a marche facilement !
</p>
<p>
</div>
<br/>
<div class="listingblock data-line-91">
<br/>
<div class="content">
<br/>
<pre>curl -v https://zc0tvoviak.execute-api.eu-west-1.amazonaws.com/dev/users/lille
</p>
<p>
{
<br/>
"message": "Hello Chti JUG",
<br/>
"input": {
<br/>
"resource": "/users/lille",
<br/>
"path": "/users/lille",
<br/>
"httpMethod": "GET",
<br/>
"headers": {
<br/>
"Accept": "*/*",
<br/>
"CloudFront-Forwarded-Proto": "https",
<br/>
"CloudFront-Is-Desktop-Viewer": "true",
<br/>
"CloudFront-Is-Mobile-Viewer": "false",
<br/>
"CloudFront-Is-SmartTV-Viewer": "false",
<br/>
"CloudFront-Is-Tablet-Viewer": "false",
<br/>
"CloudFront-Viewer-Country": "FR",
<br/>
"Host": "zc0tvoviak.execute-api.eu-west-1.amazonaws.com",
<br/>
"User-Agent": "curl/7.55.1",
<br/>
"Via": "1.1 351ae5c6dc020f41490e39fd18b2ac14.cloudfront.net (CloudFront)",
<br/>
"X-Amz-Cf-Id": "KkvQqh_2tZ40wbmC2Li9VGTYVg0_HhvCaYQ2gs-yKlLDuMq9OPc9Jg==",
<br/>
"X-Amzn-Trace-Id": "Root=1-5ce6dd72-a74747e4c52219abbbb04999",
<br/>
"X-Forwarded-For": "165.225.77.153, 70.132.45.71",
<br/>
"X-Forwarded-Port": "443",
<br/>
"X-Forwarded-Proto": "https"
<br/>
},
<br/>
"multiValueHeaders": {
<br/>
"Accept": ["*/*"],
<br/>
"CloudFront-Forwarded-Proto": ["https"],
<br/>
"CloudFront-Is-Desktop-Viewer": ["true"],
<br/>
"CloudFront-Is-Mobile-Viewer": ["false"],
<br/>
"CloudFront-Is-SmartTV-Viewer": ["false"],
<br/>
"CloudFront-Is-Tablet-Viewer": ["false"],
<br/>
"CloudFront-Viewer-Country": ["FR"],
<br/>
"Host": ["zc0tvoviak.execute-api.eu-west-1.amazonaws.com"],
<br/>
"User-Agent": ["curl/7.55.1"],
<br/>
"Via": ["1.1 351ae5c6dc020f41490e39fd18b2ac14.cloudfront.net (CloudFront)"],
<br/>
"X-Amz-Cf-Id": ["KkvQqh_2tZ40wbmC2Li9VGTYVg0_HhvCaYQ2gs-yKlLDuMq9OPc9Jg=="],
<br/>
"X-Amzn-Trace-Id": ["Root=1-5ce6dd72-a74747e4c52219abbbb04999"],
<br/>
"X-Forwarded-For": ["165.225.77.153, 70.132.45.71"],
<br/>
"X-Forwarded-Port": ["443"],
<br/>
"X-Forwarded-Proto": ["https"]
<br/>
},
<br/>
"queryStringParameters": null,
<br/>
"multiValueQueryStringParameters": null,
<br/>
"pathParameters": null,
<br/>
"stageVariables": null,
<br/>
"requestContext": {
<br/>
"resourceId": "so13c0",
<br/>
"resourcePath": "/users/lille",
<br/>
"httpMethod": "GET",
<br/>
"extendedRequestId": "aJeJ1FFMjoEFg9A=",
<br/>
"requestTime": "23/May/2019:17:50:42 +0000",
<br/>
"path": "/dev/users/lille",
<br/>
"accountId": "961550549303",
<br/>
"protocol": "HTTP/1.1",
<br/>
"stage": "dev",
<br/>
"domainPrefix": "zc0tvoviak",
<br/>
"requestTimeEpoch": 1558633842103,
<br/>
"requestId": "48707c94-7d83-11e9-ad78-57e2349266a5",
<br/>
"identity": {
<br/>
"cognitoIdentityPoolId": null,
<br/>
"accountId": null,
<br/>
"cognitoIdentityId": null,
<br/>
"caller": null,
<br/>
"sourceIp": "165.225.77.153",
<br/>
"principalOrgId": null,
<br/>
"accessKey": null,
<br/>
"cognitoAuthenticationType": null,
<br/>
"cognitoAuthenticationProvider": null,
<br/>
"userArn": null,
<br/>
"userAgent": "curl/7.55.1",
<br/>
"user": null
<br/>
},
<br/>
"domainName": "zc0tvoviak.execute-api.eu-west-1.amazonaws.com",
<br/>
"apiId": "zc0tvoviak"
<br/>
},
<br/>
"body": null,
<br/>
"isBase64Encoded": false
<br/>
}
<br/>
}</pre>
<br/>
</div>
<br/>
</div>
<br/>
<div class="paragraph data-line-174">
</p>
<p>
Bon, il y a un peu de fuite de donnÃ©es, mais dans lâ€™ensemble Ã§a marche bien.
</p>
<p>
</div>
<br/>
</div>
<br/>
<div class="sect2 data-line-176">
<br/>
<h3 id="truechalice">Chalice</h3>
<br/>
<div class="paragraph data-line-178">
</p>
<p>
<a href="https://github.com/aws/chalice/">chalice</a> est un framework Python dÃ©diÃ© au serverless, qui ressemble beaucoup Ã  flask, mais avec certains dÃ©corateurs dÃ©diÃ©s. Par contre, comme vous lâ€™aurez vu dans lâ€™url GitHub, câ€™est purement, totalement, et dÃ©finitivement dÃ©diÃ© Ã  AWS.
</p>
<p>
</div>
<br/>
<div class="paragraph data-line-181">
</p>
<p>
Et Ã§a marche tout aussi bien.
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
<br/>
</div>
<br/>
<div class="sect1 data-line-183">
<br/>
<h2 id="trueconclusion">Conclusion</h2>
<br/>
<div class="sectionbody">
<br/>
<div class="paragraph data-line-184">
</p>
<p>
Si vous avez dÃ©ja un outillage de qualitÃ© (Docker, K8s), Ã§a nâ€™est pas forcÃ©ment nÃ©cessaire. Par ailleurs, vu la raretÃ© des dÃ©veloppeurs du marchÃ© du travail, et vues les exigences du serverless, câ€™est clairement limitant. Câ€™est nÃ©anmoins extrÃªmement enthousiasmant pour les capacitÃ©s de scalabilitÃ©.
</p>
<p>
A mon avis ... on est dans une espÃ¨ce de mouvement d'avant-garde oÃ¹ on essaye de s'intÃ©grer au mieux dans un cadre financier fourni par les providers de cloud. Est-ce que c'est 'lavenir , Je n'en sais rien. En revanche, je sais que Ã§a existe depuis ... un bon moment, et que Ã§a ne semble pas totallement percer (mis Ã  part des cas bien prÃ©cis).
</p>
<p>
</div>
<br/>
</div>
<br/>
</div>
</p>
++++