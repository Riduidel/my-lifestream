:jbake-type: post
:jbake-status: published
:jbake-title: Vis ma vie de développeur de merde avec Java sur Mac
:jbake-tags: développement,java,macosx,_mois_août,_année_2013
:jbake-date: 2013-08-19
:jbake-depth: ../../../../
:jbake-uri: wordpress/2013/08/19/vis-ma-vie-de-developpeur-de-merde-avec-java-sur-mac.adoc
:jbake-excerpt: 
:jbake-source: https://riduidel.wordpress.com/2013/08/19/vis-ma-vie-de-developpeur-de-merde-avec-java-sur-mac/
:jbake-style: wordpress

++++
<p>Bon ...</p><p>Je ne vais pas forcément rentrer dans les détails, ils sont plus sordides que tout ce que vous pourriez imaginer, il suffit pour l'instant de faire <a href="https://groups.google.com/d/msg/lescastcodeurs/g5dCkJWAFTc/HEPOE6BeVagJ">l'hypothèse</a> que je travaille pour une entreprise développant une application partiellement écrite en Java et dont un composant peut fonctionner sur Mac OS.</p><p>Notez bien que, personnellement, ça fait bien longtemps que j'ai compris la nature profonde de l'OS de Cuppertino, mais bon, hein, il faut savoir faire des con-promis (ceci n'est pas une faute).</p><p>Donc ...</p><p>Et n'allez pas croire que je crois aux présages, mais quand même, Jobs sort ces jours-ci, et nous nous prosternons devant l'homme qui a, mieux que Bill Gates, mieux que les rêves les plus fous d'Orwell, mieux que la pub qu'il faisait en 84, réduire nos libertés individuelles au droit de faire ce qu'il veut (mêeme depuis sa tombe) puisque nous ne sommes que des invités chez lui.</p><p>Donc ... (on va finir par se croire dans la NLDD ici)</p><p>Je me suis retrouvé la semaine dernière à corriger un bug approchant de <a href="https://lists.apple.com/archives/java-dev/2013/Jun/msg00083.html">cette histoire traînant sur les ML d'Apple</a>.</p><p>En gros, mon application charge un composant <a href="http://fr.wikipedia.org/wiki/JMX">JMX</a> (ça, c'est prévu) qui, lui, charge <a href="http://fr.wikipedia.org/wiki/AWT">AWT</a> (le système de fenêtrage originel de Java) qui, lui, refuse de se charger pour une raison inconnue.</p><p>A l'origine de tout ça, une classe du système d'instrumentation de Java : <em>com.sun.jmx.trace.Trace</em>. Vous ne la trouverez pas sur le web puisque, comme l'indique son nom de package, c'est une classe privée de chez Sun/Oracle (par convention, les packages <em>com.sun.*</em> sont privés et ne sont pas accessibles aux simples développeurs, <strong>mais</strong> on peut y jeter un coup d'oeil dans les sources du JDK).</p><p>N'écoutant que mon courage (et la pile d'exception), j'ai été jeter un coup d'oeil autour des lignes indiquées par la pile d'exception : </p><blockquote><p>at com.sun.jmx.trace.Trace.out(Trace.java:180)</p></blockquote><p>Parce que souvent, c'est là que les problèmes se trouvent ...</p><p>Et là, je cite mon Eclipse : </p><p><a href="http://riduidel.files.wordpress.com/2013/08/java-com-sun-jmx-trace-trace-eclipse_2013-08-19_15-48-33.png"><img class="size-full wp-image" id="i-1513" alt="Image" src="http://riduidel.files.wordpress.com/2013/08/java-com-sun-jmx-trace-trace-eclipse_2013-08-19_15-48-33.png?w=576" /></a></p><p> </p><p>Eh ouais, la ligne n'existe pas dans la version dont je dispose. Et c'est là que j'ai compris que je partais tout droit en enfer, juste armé d'une brosse à dents.</p><p>Parce que figurez-vous que le JDK d'un Mac n'est pas celui d'un Windows/Linux/N'importe quoi.</p><p>Non. Il y a quelques années, Apple voulait pousser en avant Java. Ils se sont donc mis d'accord avec Sun/Oracle pour repackager un JDK Apple avec quelques additions sympathiques.</p><p>Du temps est passé sous les ponts, et cet accord s'est arrêté vers ... 2013 ? Je crois, à la demande d'Apple, qui préférait miser sur son propre langage de kalitaye (encore une fois ça n'est pas une faute) : <a href="http://fr.wikipedia.org/wiki/Objective_C">Objective-C</a> aussi pratique sur un iMac que sur un iPhone, ou encore un iFuckYouDeep.</p><p>Mais chez Apple, on aime bien laisser des bonnes surprises en partant.</p><p>Par exemple, la <a href="http://support.apple.com/kb/HT5797?viewlocale=fr_FR">mise à jour Java 16</a> de Java qui, sur tous les ordinateurs utilisant MacOS, casse méthodiquement JMX en lui ajoutant une dépendance débile sur AWT. Parce que bon, cette mise à jour passe le Java des Mac en version 1.6.0_51. Cherchez donc chez oracle cette version ... elle n'existe pas. Et ouais, l'effet <a href="http://fr.wikipedia.org/wiki/Zone_51">zone 51</a> joue à fond.</p><p>Vous en voulez encore ?</p><p>Les ordinateurs ayant reçus cette mise à jour sont tous ceux tournant sous Mac OS 10.6.8. Pour bon nombre d'entre eux, la mise à jour vers 10.7 ou 10.8 est interdite par Apple (comme ils ont interdit d'ailleurs la mise à jour de mon iBook il y a quelques années - je vous laisse chercher dans le blog).  Ah, et en bonus Oracle ne livre pas de versiond e Java 7 pour cette version de Mac OS. Donc si vous utilisez cette version, vous êtes baisés et re-baisés.</p><p>En bonus caché, certaines applications utilisent Java en version 32 bits (ou i386 si vous préférez). Or, quand bien même vous installez Java 7, il ne s'agit que de la version 64 bits ! Du coup vous vous faites chier à faire la mise à jour, mais le bug continue à exister pour toutes les vieilles applications. Et comment faire pour corriger ? Oh, be simplement demander à Adobe de se bouger le cul pour recompiler leurs applis en 64 bits.</p><p>Bref, vous êtes baisés, re-baisés, et re-re-baisés.</p><p>Comme moi maintenant qui dois trouver un contournement.</p>
++++