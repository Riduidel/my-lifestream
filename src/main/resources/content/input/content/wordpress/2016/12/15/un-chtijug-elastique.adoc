:jbake-type: post
:jbake-status: published
:jbake-title: Un chtijug Ã©lastique
:jbake-tags: chtijug,logs,search,_mois_dÃ©c.,_annÃ©e_2016
:jbake-date: 2016-12-15
:jbake-depth: ../../../../
:jbake-uri: wordpress/2016/12/15/un-chtijug-elastique.adoc
:jbake-excerpt: 
:jbake-source: https://riduidel.wordpress.com/2016/12/15/un-chtijug-elastique/
:jbake-style: wordpress

++++
<p>
D'abord, quelques annonces
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/chtijug" class="screenName"><img src="http://pbs.twimg.com/profile_images/1179656487326617600/2uFfDuut_mini.jpg" alt="profile of Le Java User Group des Ch'tis d'un Ch'nord"/>chtijug</a>
<br/>
<span class="name">Ch'ti JUG</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/chtijug/status/809Â 095Â 128Â 803Â 672Â 064" class="date">14 dÃ©c. 2016 Ã  18:58:05</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Annonce du DevFest le 9 juin Ã  @eartsup Ã  Lille ! Cfp et inscription ouverte sur https://t.co/LwFyorGlx9 https://t.co/eeFAMw9NzM</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/Czp7sWbWgAAP7jV.jpg" alt="809Â 095Â 084Â 931Â 186Â 688"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
</p>
<p>
A 20 â‚¬ ! Ca va Ãªtre dur de faire valider la note de frais.
</p>
<p>
Pour les slides, c'est par lÃ 
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/dadoonet" class="screenName"><img src="http://pbs.twimg.com/profile_images/994322254975684608/2E-48xZA_mini.jpg" alt="profile of developer | evangelist @elastic We are hiring ğŸ“§ DM opened. DJ 4 times a year, just for fun! ğŸ§ https://t.co/xhIEHl0eB0"/>dadoonet</a>
<br/>
<span class="name">David PilatoğŸ‡ªğŸ‡ºğŸ‡«ğŸ‡·</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/dadoonet/status/809Â 178Â 612Â 620Â 529Â 664" class="date">15 dÃ©c. 2016 Ã  00:29:49</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Slides for my talk about #elasticsearch Ingest Node at @chtijug are available here: https://t.co/mrPyFO7aMP. Happy coding!</span>
</p>
<p>
<span class="medias">
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
</p>
<p>
Elastic, c'est 4 projets open-source :
<br/>
<ul>
<br/>
<li>Logstash (malheureusement Ã©crit en JRuby)</li>
<br/>
<li>Beats (alternatives Ã  Logstash en go beaucoup plus simple). il y a FileBeats, NetworkBeats, MetricBeats</li>
<br/>
<li>Elasticsearch (moteur d'indexation et de recherche JSON. Ne loupez pas l'interview de notre speaker chez <a href="https://lescastcodeurs.com/2016/12/02/lcc-158-interview-sur-elasticsearch-avec-david-pilato/">lescastcodeurs</a>)</li>
<br/>
<li>Kibana (outil de dashboard)</li>
<br/>
</ul>
<br/>
Et un ensemble de solution commerciales appelÃ©es gÃ©nÃ©riquement X-Pack
</p>
<p>
En particulier, graph permet d'Ã©viter le problÃ¨mes des supernoeuds dans les graphes (un problÃ¨me auquel je suis assez <a href="https://github.com/Riduidel/gaedo/issues/52">sensible</a>, mais je m'Ã©loigne du sujet).
<br/>
Et prelert va identifier les erreurs "exceptionnelles" grÃ¢ce Ã  de l'apprentissage.
<br/>
<h2>A quoi sert elasticsearch ?</h2>
<br/>
Ben Ã  faire des recherches floues, oÃ¹ Ã  trier les rÃ©sultats de recherche selon ... un score. Et floue, Ã§a implique de gÃ©rer les fautes d'orthographe, les textes approchants, les synonymes, ...
</p>
<p>
Et maintenant, le coeur de la prÃ©sentation : ingest node
</p>
<p>
Avec ingest, on peut remplacer l'architecture classique
</p>
<p>
<img class="alignnone size-full wp-image-4064" src="https://riduidel.files.wordpress.com/2016/12/iyxfbszfiyqhkn3bp4briaqiaupaxelvvas7bogmpowa5ifpxazotebfsoa4r1ixorlc91qnp2o7foom9mtmmmtkjkco3cvfsa5c1vc85kpm5kqwtyzc0g00.png" alt="iyxfbszfiyqhkn3bp4briaqiaupaxelvvas7bogmpowa5ifpxazotebfsoa4r1ixorlc91qnp2o7foom9mtmmmtkjkco3cvfsa5c1vc85kpm5kqwtyzc0g00" width="578" height="55" />
</p>
<p>
par une architecture beaucoup plus simple
</p>
<p>
<img class="alignnone size-full wp-image-4067" src="https://riduidel.files.wordpress.com/2016/12/iyxfbszfiyqhkn3bp4briaqiaupaxekvvygmbsgc1wsc5ylda5hpag01gjopbpsrk8ihbwkkllvn3y880000.png" alt="iyxfbszfiyqhkn3bp4briaqiaupaxekvvygmbsgc1wsc5ylda5hpag01gjopbpsrk8ihbwkkllvn3y880000" width="154" height="167" />
</p>
<p>
Du coup, le pipeline de transformation Logstash (grok, date, mutate) est remplacÃ© par un Ã©quivalent ingest (grok, date, remove). Il y a naturellement tout un tas de plugins (dont la lecture d'attachments avec Tika). Bon, autrement dit, on remplace un ETL par un autre, espÃ©rons juste qu'il soit plus performant. Et Ã©videment, on peut crÃ©er ses propres plugins.
</p>
<p>
Il y a quand mÃªme un gros intÃ©rÃªt, puisque les pipelines ingest sont utilisables dans la plupart des urls d'appel Ã  Elasticsearch. Et en particulier, dans l'un des trucs les plus balaizes : le reindex. Ce reindex permet la migration facile d'un cluster Elasticsearch d'une vieille version vers une nouvelle. Et Ã§a, Ã§a me paraÃ®t vraiment trÃ¨s chouette.
</p>
<p>
Comme dans n'importe quel ETL, il est possible de dÃ©finir des failure processors qui vont Ãªtre utilisÃ©s en cas d'Ã©chec lors de la sÃ©rie de transformation. On peut les dÃ©finir par pipeline ou par processeur.
</p>
<p>
Dans un cluster, (parce que oui, Elasticsearch fonctionne toujours en cluster), il est possible de laisser tous les noeuds faire de l'ingestion, on d'en forcer certains Ã  faire l'ingestion. En prod, d'ailleurs, il vaut mieux sÃ©parer les noeuds d'ingestion des noeuds de donnÃ©es.
<br/>
<h2>Et si on regardait un plugin ?</h2>
<br/>
Par exemple, le fameux plugin BANO (dÃ©ja mentionnÃ© chez les castcodeurs). BANO pour base nationale d'adresses, parce que David est fan des adresses postales. Et cette base, ce sont des documents CSV (ou JSON) disponibles chez OpenStreetMap.
<br/>
Donc David a un plugin qui lui permet de charger dans Elasticsearch la base des adresses, puis d'enrichir les adresses et les localisations GPS en ajoutant la donnÃ©e inverse.
</p>
<p>
Et maintenant, c'est le moment de la dÃ©mo !
</p>
<p>
Et franchement, au dÃ©but, la dÃ©finition de pipeline d'ingestion est assez facile, et la dÃ©finition des failure processors est tout aussi facile. J'imagine trÃ¨s bien les interfaces trÃ¨s graphiques faisables lÃ -dessus.
<br/>
Pour la rÃ©cupÃ©ration des donnÃ©es, le fait que ce soit un moteur de recherche fait que des rÃ©sultats moins pertinents pourront Ãªtre retournÃ©s par les requÃªtes, mais derriÃ¨re les rÃ©sultats les plus pertinents.
</p>
<p>
Un autre Ã©lÃ©ment intÃ©ressant, c'est que la recherche est foutrement rapide : l'ingestion d'une coordonnÃ©e GPS avec ajout automatique des adresses (et donc recherche dans l'index des coordonnÃ©es) est immÃ©diate (pour autant qu'on puisse le voir). MÃªme si la coordonnÃ©e GPS n'est pas exactement la bonne.
</p>
<p>
Et avec tout Ã§a, et le processor GeoIP, il est par exemple possible d'envoyer un courier Ã  l'adresse donnÃ©e lors de la requÃªte HTTP. Ca fout la trouille, hein ?
</p>
<p>
Au passage, l'un des trucs les plus intÃ©ressants selon moi est l'utilisation de JSON pour exprimer les requÃªtes : le code n'est pas moins clair qu'avec un langage de requÃªte dÃ©diÃ© (genre SQL).
</p>
<p>
Un autre intÃ©rÃªt d'Elasticsearch, c'est qu'il supporte les tÃ¢ches longues, qu'on peut suivre et gÃ©rer (pour par exemple tuer les tÃ¢ches trop longues).
<br/>
<h2>Non mais, et si on dÃ©veloppait vraiment un plugin ?</h2>
<br/>
Eh bien ce serait aussi simple que d'Ã©crire une classe Ã©tendant une superclasse abstraite.
<br/>
Evidement, quand on regarde le code, on voit des choses ... curieuses : trouver le point le plus proche en calculant la distance de tous les points, je peux dire que c'est pas le plus efficace (il n'y a pas d'index gÃ©ographiques ou <a href="https://fr.wikipedia.org/wiki/Quadtree?oldformat=true">quadtrees </a>dans Lucene ? Ah si, Ã  priori, avec les <a href="https://en.wikipedia.org/wiki/K-d_tree?oldformat=true">bkdtree </a>de Lucene 6).
<br/>
Dans le mÃªme ordre d'idÃ©e, dÃ©clarer ses plugins en associant une clÃ© Ã  une factory ... alors qu'on peut faire du CDI ? C'est pas fameux. mais bon, tout le monde n'est pas censÃ© Ã©crire des plugins.
<br/>
<h2>Conclusion</h2>
<br/>
L'un des plus gros intÃ©rÃªts de cette prÃ©sentation, c'est de sortir Elasticsearch de son rÃ´le le plus connu de stockage ELK pour bien montrer qu'avant tout, c'est un ETL moderne qu'on sous-utilise volontiers.
</p>
<p>
Et personnellement, en voyant cette prÃ©sentation, j'ai eu l'envie un peu folle de resortir mes projets de livestream pour les porter dans une base plus moderne.
</p>
<p>
Et pour la blague, le premier rang, c'est pratique pour dÃ©montrer la prÃ©sence quand le speaker fait des selfies
</p>
<p>
<div class='twitter'>
<br/>
<span class="twitter_status">
</p>
<p>
<span class="author">
</p>
<p>
<a href="http://twitter.com/dadoonet" class="screenName"><img src="http://pbs.twimg.com/profile_images/994322254975684608/2E-48xZA_mini.jpg" alt="profile of developer | evangelist @elastic We are hiring ğŸ“§ DM opened. DJ 4 times a year, just for fun! ğŸ§ https://t.co/xhIEHl0eB0"/>dadoonet</a>
<br/>
<span class="name">David PilatoğŸ‡ªğŸ‡ºğŸ‡«ğŸ‡·</span>
</p>
<p>
</span>
</p>
<p>
<a href="https://twitter.com/dadoonet/status/809Â 143Â 713Â 972Â 813Â 825" class="date">14 dÃ©c. 2016 Ã  22:11:09</a>
</p>
<p>
<span class="content">
</p>
<p>
<span class="text">Thank you @chtijug attendees for listening! https://t.co/lhRGG2CalC</span>
</p>
<p>
<span class="medias">
<br/>
<span class="media media-photo">
<br/>
<img src="http://pbs.twimg.com/media/Czqn6DNXUAAP18d.jpg" alt="809Â 143Â 698Â 802Â 036Â 736"/>
<br/>
</span>
<br/>
</span>
</p>
<p>
</span>
</p>
<p>
<span class="twitter_status_end"/>
<br/>
</span>
<br/>
</div>
</p>
++++